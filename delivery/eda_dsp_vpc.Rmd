---
title: "Análisis de Datos Exploratorios"
author: "Michelle Audirac y Valeria Pérez Cong"
date: "2018-08-08"
output: html_document
---

# Programas en Ciencia de Datos

En este trabajo hago un análisis exploratorio en R de una tabla que contiene datos de programas en DS (Ciencia de Datos) en USA.

La descarga de la tabla `timesMergedData.csv` se hace aquí: https://www.kaggle.com/sriharirao/datascience-universities-across-us/data. 

## Metadata de columnas



Paquetería necesaria: 
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
require(magrittr, quietly = TRUE, warn.conflicts = FALSE)
require(dplyr, quietly = TRUE, warn.conflicts = FALSE)
require(tidyr, quietly = TRUE, warn.conflicts = FALSE)
require(ggplot2, quietly = TRUE, warn.conflicts = FALSE)
require(leaflet, quietly = TRUE, warn.conflicts = FALSE)
require(rgdal, quietly = TRUE, warn.conflicts = FALSE)
require(ngram, quietly = TRUE, warn.conflicts = FALSE)
require(rgdal, quietly = TRUE, warn.conflicts = FALSE)
require(leaflet, quietly = TRUE, warn.conflicts = FALSE)
library(plotly)
library(stringr)
library(knitr)


# Lectura API 
# Librerías necesarias
# require(jsonlite)
# library(tibble)
# library(plyr)
# library(tidyr)
# library(dplyr)
# library(knitr)
# library(ggplot2)
# library(plotly)
# library(RColorBrewer)
```

Primero cargo `timesMergedData.csv` en `dsp`.
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
dsp <- read.csv('/home/valeria/Desktop/datank/blogs/ds_offer/timesMergedData.csv')
```

El data frame contiene `dim(dsp)` renglones y columnas.

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
dim(dsp)
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# summary(dsp)
```

Entre las variables que queremos estudiar, por la información que nos puede proveer es *school*, *state*, *type*, *department* (sobretodo para ver cuántos son de mate, statistics, business o compu), *prerequisites* (pues para ver cómo debes prepararte si quieres entrar), *loc_lat*, *loc_long*, *world_rank*, *international_students*, *f_m_ratio* (female:male ratio, porque siempre es interesante ver la proporción de hombres y mujeres).

Michelle ya exploró las variables year (2016 o NA), delivery (y aparte puso los tags en orden), school, state, city, program y type.  

### Year
Para que haya consistencia con el análisis de Michelle, hago el mismo filtro de los años para solo ocupar la información del 2016 y NAs. 
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
summary(as.factor(dsp$YEAR))
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
library(dplyr)
dsp %<>% filter(YEAR == 2016 | is.na(YEAR))
dsp %<>% distinct() 
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
dim(dsp)
```

Si nos quedamos con las observaciones del 2016 y que no tienen año, el conjunto de datos se reduce a la mitad y de 954 observaciones se pasa a 416. 

Más adelante se crean dos variables: "Department" y "Prerequisites". Uno de los
objetivos del blog es analizar los prerequisitos por departmento, tons para
hacer el match entre estas dos variables, se va a crear un id de observación. 

Esto lo decidí porque no hay columna con valores únicos. Tipo, hay hasta 24 
programas con el mismo nombre... Entonces si decidía hacer match entre programas
y prerequisites sería súper misleading. 
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
dsp <- dsp %>% 
  mutate(id = 1:dim(dsp)[1])

# dsp
```

### Delivery

Se hace el mismo ajuste de las tags. 
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
dsp %>% group_by(DELIVERY) %>% summarize(n = n())
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
dsp %<>% 
  mutate(DELIVERY2 = recode(DELIVERY, 
                            'Blended' = 'Hybrid',
                            'Campus and online' = 'Hybrid',
                            'Campus or Online' = 'Campus or online',
                            'Campus, Online' = 'Campus or online',
                            'On Campus' = 'Campus',
                            'Online (one Saturday per month on-campus)' = 'Hybrid',
                            'Online or Campus' = 'Campus or online',
                            'Online or On Campus' = 'Campus or online',
                            'Online or campus' = 'Campus or online',
                            'Online, campus, or hybrid' = 'Campus or online'))
```



```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
count_programas <- dsp %>% group_by(DELIVERY2) %>% summarize(n = n()) %>% 
  mutate(proporcion = round(n / sum(n),4)*100) %>% 
  mutate(porcentaje = paste0(proporcion, "%")) %>% 
  arrange(n)
count_programas
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# uso x = 'FORMATO'

ggplotly(
  count_programas %>% 
  ggplot(aes(x = reorder(DELIVERY2, n), y = proporcion, fill = as.factor(DELIVERY2))) + 
  geom_col(position = "stack", colour = 'grey', alpha = 0.7, width = .5) +
  labs(title = "Número de Programas de Data Science según Delivery", x = "", y = "") + 
    theme_bw() + 
    labs(fill = "Tipo Delivery", y = "Número de Programas", x = "Tipo Delivery") + 
    scale_y_continuous(limits = c(0,100)) + 
    geom_text(aes(label = porcentaje))
)

```

Es decir, la mayoría de los programas se imparten físicamente en el Campus de la Universidad. 

### School

Se hace el mismo ajuste de las tags. 
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
count_school <- dsp %>% group_by(SCHOOL) %>% 
  summarise(num_prog = n()) %>% 
  arrange(desc(num_prog))

#count_school
```

Hay 218 escuelas que ofrecen programas de DS, las escuelas que más programas ofrecen son Bentley University y New York University.


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
summary(count_school$num_prog)
```


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
#2 programas es el tercer cuartil, por lo que filtramos para ver las escuelas cuyo número de programas corresponde al último cuartil (el 25% con más programas)

ggplotly(
  filter(count_school,num_prog>3) %>% 
  ggplot(aes(x = reorder(SCHOOL,num_prog), y = num_prog, fill = as.factor(num_prog))) + 
  geom_col(position = "stack", colour = 'grey', alpha = 0.7, width = .5) + 
    coord_flip()+ 
    theme_bw()+ 
    labs(title = "Número de Programas por Escuela", 
         fill="Count", 
         y="Número de Programas", 
         x="Escuelas") + 
    scale_y_discrete(limits = c(0,3,5,7,9))
)
```

En esta gráfica se puede apreciar el número de programas por Escuela. Por Simplicidad, únicamente se muestran las escuelas con 4 o más programas. Se puede observar que NYU y Bentley University son las escuelas con el mayor número de programas, teniendo 9 en total. 

### Análisis por Escuela y tipo de delivery
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
count_school_delivery <- dsp %>% 
  group_by(SCHOOL,DELIVERY2) %>% 
  summarise(num_prog=n()) %>% 
  arrange(SCHOOL)

# count_school_delivery
```


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
summary(count_school_delivery$num_prog)
```


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
#2 programas es el tercer cuartil, por lo que filtramos para ver las escuelas cuyo número de programas corresponde al último cuartil (el 25% con más programas)

ggplotly(
  ggplot(filter(count_school_delivery,num_prog>2), aes(x=reorder(SCHOOL,num_prog),y=num_prog, fill = as.factor(DELIVERY2))) + 
  geom_col(position = "stack", colour = 'grey', alpha = 0.7, width = .5) + coord_flip()+ theme_bw()+labs(title = "Número de Programas por Escuela",fill="Delivery",y="Número de Programas",x="Escuelas")
)
```




### State
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
count_state <- dsp %>% 
  group_by(STATE, LOC_LAT, LOC_LONG) %>% 
  summarise(num_prog = n()) %>% 
  arrange(desc(num_prog))

# count_state
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
summary(count_state$num_prog)
```


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
#2 programas es el tercer cuartil, por lo que filtramos para ver las escuelas cuyo número de programas corresponde al último cuartil (el 25% con más programas)
# 
# ggplotly(
#   ggplot(filter(count_state,num_prog>=13), aes(x=reorder(STATE,num_prog),y=num_prog, fill = as.factor(num_prog))) + 
#   geom_col(position = "stack", colour = 'grey', alpha = 0.7, width = .5) + coord_flip()+ theme_bw()+labs(title = "Número de Programas por Estado",fill="Count",y="Número de Programas",x="Estados")
# )
```

California es el estado con mayor número de programas. 


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}

# leaflet(colonias_df) %>%setView(lng = -99.170, lat = 19.40100, zoom = 13) %>%
#      addTiles() %>%  # Add default OpenStreetMap map tiles 
#      addProviderTiles(providers$CartoDB.Positron)%>%
#      addCircleMarkers(lat = ~lat, lng = ~lng,
#                       color = "white",
#                       fillColor = ~pal(colonia),
#                       fillOpacity = 1,
#                       popup = ~htmlEscape(content_colonia), label = ~as.character(colonia))
```



### Análisis según el estado y delivery
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
ggplotly(
  ggplot(dsp, aes(STATE, fill = DELIVERY2)) +
  geom_bar(colour = 'grey', alpha = 0.7) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(title = "Número de programas DS por Estado según Delivery", 
       x = "Estado", y = "Conteo", fill = "Delivery")
)

```


### Mapa de densidad según el número de programas por Estado
Usar el mapita de Michelle. 

### Análisis por City 
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# count_city_state <- dsp %>% group_by(STATE,CITY,DELIVERY2) %>% summarise(num_prog=n()) %>% arrange(STATE)
# count_city_state
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# summary(count_city_state$num_prog)
```


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
#2 programas es el tercer cuartil, por lo que filtramos para ver las escuelas cuyo número de programas corresponde al último cuartil (el 25% con más programas)

# ggplotly(
  # ggplot(filter(count_city_state,num_prog>2), aes(x=reorder(CITY,num_prog),y=num_prog, fill = as.factor(DELIVERY2))) + 
  # geom_col(position = "stack", colour = 'grey', alpha = 0.7, width = .5) + coord_flip()+ theme_bw()+labs(title = "Número de Programas por Ciudad",fill="Delivery",y="Número de Programas y tipo de Delivery",x="Ciudad") + scale_y_continuous()
# )
```


### Departament

The popularity of Data Science is increasing by the day, and the main reasons for this is its applicability.
Because of all the technology that surrounds us and the amount of data available, there's a great variety of 
ways in which knowledge of Data Science can be applied. 

Data Science is a broad discipline, and  it requieres vast knowledge on math and statistics, computer science and
domain knowledge. The approach given to a Data Science program can vary a lot, and that's the reason why we 
decided to explore the different school departments in charge of the programs. We are assuming that the department
is what determines the scope given to the program. 

To simplify the analysis we decided to create 8 <b> 'big' </b> categories: Business, Math, Statistics, Computer Science,
Data Science, Science, Engineering and Technology. It is important to mention that a single program can fall in different
categories, specially the science programs. Some programs don't fall into any category, this can be due to generic department names like 
'College of Interdisciplinary Studies	'. 

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# 
# dsp %>% 
#   group_by(PROGRAM) %>% 
#   summarise(count_program = n()) %>% 
#   filter(count_program > 1) %>% 
#   arrange(desc(count_program))

  
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
depto <- dsp %>% 
  select(id, SCHOOL, STATE, PROGRAM, DEPARTMENT, DELIVERY2,PREREQ)

# depto
```


### Recoding of the department

In order to categorize observations into the 8 big categories we created a new column called *depto*,
this column contains the recoded version of the department of each program in 
the data set. For example, some of the departments present were "Erivan K. Haub School of Business" 
and "Kogod School of Business", the value of *depto* for both will now be "depto_business". 

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
depto <- depto %>%
  mutate(dept_business = ifelse(
    grepl("business", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("management", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("administration", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("administrative", depto$DEPARTMENT, ignore.case = TRUE), 1, 0)) %>%
  
  mutate(dept_math = ifelse(
    grepl("math", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("mathematics", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("mathematical", depto$DEPARTMENT, ignore.case = TRUE), 1, 0)) %>%
  
  mutate(dept_statistics = ifelse(
    grepl("statistics", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("statistical", depto$DEPARTMENT, ignore.case = TRUE) , 1, 0)) %>%
  
  mutate(dept_science = ifelse(
    grepl("science", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("sciences", depto$DEPARTMENT, ignore.case = TRUE) , 1, 0)) %>%
  
  mutate(dept_computer_science = ifelse(
    grepl("computer science", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("computer sciences", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("computer", depto$DEPARTMENT, ignore.case = TRUE), 1, 0)) %>%
  
  mutate(dept_data_science = ifelse(
    grepl("data science", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("data sciences", depto$DEPARTMENT, ignore.case = TRUE), 1, 0)) %>%
  
  mutate(dept_engineering = ifelse(
    grepl("engineer", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("engineering", depto$DEPARTMENT, ignore.case = TRUE), 1, 0)) %>%
  
  mutate(dept_technology = ifelse(
    grepl("tech", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("technological", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("technology", depto$DEPARTMENT, ignore.case = TRUE) |
    grepl("information technology", depto$DEPARTMENT, ignore.case = TRUE), 1,0)) %>% 
  
  mutate(sum_deptos = dept_business + dept_math + dept_statistics + dept_science + 
           dept_computer_science + dept_data_science + dept_engineering + 
           dept_technology) %>% 
  
  gather(dept_business, dept_math, dept_statistics, dept_science,
         dept_computer_science, dept_data_science, dept_engineering, 
         dept_technology, key = "depto", value = "present") %>% 
  
  filter(present == 1) %>% 
  
  arrange(id)
  
head (depto, 10)
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
count_dept <- depto %>% 
  group_by(depto) %>% 
  summarise(num_prog=n()) %>% 
  arrange(desc(num_prog))

count_dept <- count_dept %>% 
  mutate(de = sub("dept_","",depto)) %>% 
  mutate(dep = sub("_"," ",de)) %>%
  mutate(dept = str_to_title(dep))  %>% 
  select(-de, -dep) %>% 
  select(depto, dept, num_prog) %>% 
  mutate(prop_prog = round(num_prog/sum(num_prog),4)*100) %>% 
  mutate(porcentaje = paste0(prop_prog, "%"))

# select(count_dept,  )

count_dept %>% 
  select(dept, num_prog, porcentaje) %>% 
  kable(col.names = c("Department", "Programs", "% of Total"))
```

Again, the new categories for *depto* are not mutually exclusive, so the same program can fall into different categories. 


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# uso x = 'FORMATO'
#names(deptos_especiales)<- c("disciplinas","num_prog","prop")

plot_deptos <- count_dept %>% 
  ggplot(aes(x = reorder(dept, num_prog), y = prop_prog, 
             fill = as.factor(dept))) + 
  geom_col(colour = 'grey', alpha = 0.7, width = .5) + 
  geom_text(aes(label = porcentaje)) + 
  theme(axis.text.x = element_text(angle = 65, vjust = 0.5, hjust = 1, 
                                   size = rel(0.9)), 
        plot.background = element_rect(fill = "white"),
        panel.background = element_rect(fill = "white", colour = "grey50"),
        legend.position = "bottom") + 
  #theme_bw() + 
  labs(title = "Number of Programs per Department", 
       x = "Department", 
       y = "Proportion of Total", 
       fill="Discipline") + 
  scale_y_continuous(limits = c(0,100))
  
  
ggplotly(plot_deptos)

```

Here, we can see that departments related to Business are in charge of 40.65% of
the programs, departments related to Science account for 24.44% of the programs, and the Computer Science Departments are in charge of 8.23% of the programs.

Something interesting to notice is that only 2% of the programs are held by a Data Science Department. Our theory is that little by little more Data Sciente departments are going to be created, because of the popularity of this discipline. It would be interesting to analyze how much did this proportion changed from years before. 


### Prerequisites

As we already mentioned, Data Science requieres vast knowledge on math, statistics and computer science. That's the reason why some programs requiere applicants to have knowledge in these areas. Just like with departments, we created a new column called *"prerequisite"*. 

Let's take a look at the prerequisites for the programs. 

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}

depto <- depto %>%
  mutate(PREREQ = as.character(PREREQ)) %>% 
  
  mutate(biology = ifelse(grepl("biology", PREREQ, ignore.case = TRUE),
        1, 0)) %>%
  
  mutate(computer_science = ifelse(grepl("computer science", PREREQ,
        ignore.case = TRUE), 1, 0)) %>%
  
  mutate(math = ifelse(grepl("math", PREREQ, ignore.case = TRUE), 
        1, 0)) %>%
  
  mutate(statistics = ifelse(grepl("stat", PREREQ, ignore.case = TRUE),
        1, 0)) %>%
  
  mutate(economics = ifelse(grepl("eco", PREREQ, ignore.case = TRUE),
        1, 0)) %>%
  
  mutate(not_available = ifelse(grepl("not", PREREQ, ignore.case = TRUE),
        1, 0)) %>%
  
  mutate(degree = ifelse(grepl("degree", PREREQ, ignore.case = TRUE), 1, 
        0)) %>%
  
  gather(biology, computer_science, math, statistics, economics, not_available, 
         degree, key = "prerequisite", value = "required") %>% 
  
  filter(required == 1) %>% 
  
  select(-present, -required) %>% 
  
  arrange(id)


head(depto, 10)
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
count_prerq <- depto %>% 
  group_by(prerequisite) %>% 
  summarise(num_prog = n()) %>%
  mutate(prereq = sub("_"," ",prerequisite)) %>% 
  mutate(prereq = str_to_title(prereq)) %>% 
  select(prerequisite, prereq, num_prog) %>% 
  mutate(prop_prog = round(num_prog/sum(num_prog) * 100, 2)) %>% 
  mutate(porcentaje = paste0(prop_prog, "%"))


count_prerq %>% 
  select(prereq, num_prog, porcentaje) %>% 
  kable(col.names = c("Prerequisites", "Programs", "% of Total"))
```


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# uso x = 'FORMATO'

ggplotly(
  count_prerq %>% 
  ggplot(aes(x=reorder(prereq, num_prog), y = prop_prog, fill = as.factor(prereq))) + 
  geom_col(colour = 'grey', alpha = 0.7, width = .5) + 
    geom_text(aes(label = porcentaje)) + 
    theme(axis.text.x = element_text(angle = 65, vjust = 0.5, hjust = 1, 
                                   size = rel(0.9)),
          plot.background = element_rect(fill = "white"),
          panel.background = element_rect(fill = "white", colour = "grey50"),
          legend.position = "bottom") +
    
  labs(title = "Number of Programs per Prerequisite", 
       x = "Prerequisites", 
       y = "Percentage of Total", 
       fill="Prerequisites") 
)

```

Unfortunately, information about prerequisites of 44.85% of the programs is not avalaible. It is clear that math, statistics and computer science skills are *vital* skills for anyone who wants to become a data scientist. 


### State and Department

We decided to explore the department of each program by state of the United States. 

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
state_department <- depto %>% 
  group_by(STATE, depto) %>% 
  summarise(num_prog = n()) %>% 
  
  mutate(de = sub("dept_","",depto)) %>% 
  mutate(dep = sub("_"," ",de)) %>%
  mutate(dept = str_to_title(dep))  %>% 
  select(-de, -dep) %>% 
  mutate(prop_prog = round(num_prog/sum(num_prog),4)*100) %>% 
  mutate(porcentaje = paste0(prop_prog, "%"))


# state_department
```

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# uso x = 'FORMATO'

ggplotly(
  state_department %>% 
  ggplot(aes(x = reorder(STATE, num_prog), y = num_prog)) + 
  geom_col(aes(fill = dept), colour = 'grey', alpha = 0.7, width = .5) + 
    #geom_text(aes(label = porcentaje)) + 
    theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust = 1, 
                                   size = rel(0.9)),
          plot.background = element_rect(fill = "white"),
          panel.background = element_rect(fill = "white", colour = "grey50"),
          legend.position = "bottom") +
    
  labs(title = "Number of programs per State", 
       x = "State", 
       y = "Programs", 
       fill="Department") + 
    
  coord_flip()
)

```

We can observe that the states of New York, California and Massachusetts are the states with the most number of programs. Most of the programs in New York belong to the department of Science (color blue). On the other side, most of the programs in California belong to the Business department (color coral). Back to the East, most programs in Massachusetts belong to the Business department. 

### Delivery and Department

We decided to explore the relationship between the Department and the type of delivery of each program. 

```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
delivery_department <- depto %>% 
  group_by(depto, DELIVERY2) %>% 
  summarise(num_prog = n()) %>% 
  
  mutate(de = sub("dept_","",depto)) %>% 
  mutate(dep = sub("_"," ",de)) %>%
  mutate(dept = str_to_title(dep))  %>% 
  select(-de, -dep)

# delivery_department
```


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# uso x = 'FORMATO'

ggplotly(
  delivery_department %>% 
  ggplot(aes(x = reorder(dept, num_prog), y = num_prog)) + 
  geom_col(aes(fill = DELIVERY2), colour = 'grey', alpha = 0.7, width = .5) + 
    #geom_text(aes(label = porcentaje)) + 
    theme(axis.text.x = element_text(angle = 65, vjust = 0.5, hjust = 1, 
                                   size = rel(0.9)),
          plot.background = element_rect(fill = "white"),
          panel.background = element_rect(fill = "white", colour = "grey50"),
          legend.position = "bottom") +
    
  labs(title = "Delivery per Department", 
       x = "Department", 
       y = "Number of Programs", 
       fill="Delivery") 
)

```

It is easy to notice that in all departments most programs are delivered physically on campus (color green). The Business and the Science departments are the ones with the most number of programs online. 

### Prerequisites and Department 
```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
prereq_department <- depto %>% 
  group_by(depto, prerequisite) %>% 
  summarise(num_prog = n()) %>% 
  
  mutate(de = sub("dept_","",depto)) %>% 
  mutate(dep = sub("_"," ",de)) %>%
  mutate(dept = str_to_title(dep))  %>% 
  select(-de, -dep) %>% 
  
  mutate(prereq = sub("_"," ",prerequisite)) %>% 
  mutate(prereq = str_to_title(prereq)) %>% 
  mutate(prop_prog = round (num_prog/sum(num_prog),4))


# prereq_department
```


```{r echo=T, warning=FALSE, error=FALSE, message=FALSE}
# uso x = 'FORMATO'

ggplotly(
  prereq_department %>% filter(prereq != "Not Available") %>% 
  ggplot(aes(x = dept, y = prop_prog)) + 
  geom_col(aes(fill = prereq), position = "fill", colour = 'grey', alpha = 0.7, width = .5) + 
    #geom_text(aes(label = porcentaje)) + 
    theme(axis.text.x = element_text(angle = 65, vjust = 0.5, hjust = 1, 
                                   size = rel(0.9)),
          plot.background = element_rect(fill = "white"),
          panel.background = element_rect(fill = "white", colour = "grey50"),
          legend.position = "bottom") +
    
  labs(title = "Prerequisites per Department", 
       x = "Department", 
       y = "Proportion of all Programs", 
       fill="Prerequisites") + 
  scale_y_continuous(limits = c(0, 1)) 
)

```

In this graph we can explore the prerequisites per program. We can observe that math and statistics are prerequisites for programs in all departments. All departments have programs that require applicants to have a bachelor degree, specially the department of Engineering and the department of Computer Science. 
